import{h as d,e as n}from"./index-C7fbPomJ.js";import{a as u}from"./api-tK1gIUgM.js";const w=d("authService",()=>{const l=n(!1),a=n(""),f=n(!1),c=n(!1);return{error:a,loading:l,registred:c,authenticated:f,register:async(e,i,r)=>{try{l.value=!0;const o=await u.post(e,{...i,foto_perfil:r});if(c.value=!0,alert(o.data.message),o.data.tokens){const{accessToken:s,refreshToken:t}=o.data.tokens;localStorage.setItem("accessToken",s),localStorage.setItem("refreshToken",t),alert(`Bem vindo(a) ${o.data.user.name}`),window.location.href="/user/profile"}}catch(o){if(o.response&&o.response.data){const s=o.response.data;for(let t in s)a.value+=`${t.toUpperCase()}: ${s[t]}
`;alert(a.value)}}finally{l.value=!1,a.value="",c.value=!1}},login:async(e,i)=>{try{l.value=!0;const r=await u.post(e,i),{access:o,refresh:s}=r.data;localStorage.setItem("accessToken",o),localStorage.setItem("refreshToken",s),f.value=!0;const t=r.data.user.nome;alert(`Bem vindo(a) ${t}`),window.location.href="/user/profile"}catch(r){a.value="Usuário ou senha inválidos",alert(a.value),console.log(r)}finally{l.value=!1,a.value=""}},profile:async()=>{try{const e=await u.get("auth/profile/");return console.log("Perfil atualizado!"),console.log(e.data.user),e.data.user}catch(e){e.response?e.response.status===401?(alert("Token inválido ou expirado. Faça login novamente."),localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/user/login"):alert(`Erro: ${e.response.status} - ${e.response.data.message||"Erro desconhecido"}`):alert("Erro de conexão"),console.log(e)}},logOut:()=>{localStorage.clear(),window.location.href="/user/login"}}});export{w as u};
